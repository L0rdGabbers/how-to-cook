{% extends "base.html" %} {% block content %} {% load crispy_forms_tags %}

<div class="container mb-4">
  <div class="row">
    <div class="col-md-6">
      <div class="row">
        <h1>{{ recipe.title }}</h1>
      </div>
      <div class="row">
        <p>{{ recipe.author }} | {{ recipe.created_on }}</p>
      </div>
      <div class="row">
        <div class="col-md-3">
          <i class="fa-solid fa-gauge"></i>
          <p>{{ recipe.difficulty }}</p>
        </div>
        <div class="col-md-3">
          <i class="fa-solid fa-stopwatch"></i>
          <p>{{ recipe.time_to_prepare }} minutes</p>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="image-container">
        {% if "placeholder" in recipe.featured_image.url %}
        <img
          src="https://images.pexels.com/photos/269257/pexels-photo-269257.jpeg"
          class="img-fluid"
        />
        {% else %}
        <img src=" {{ recipe.featured_image.url }} " class="img-fluid" />
        {% endif %}
      </div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <div class="col">
      <div class="card-body">
        <h3 class="card-text">{{ recipe.summary | safe }}</h3>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <div class="row">
        <h4>Ingredients:</h4>
        <div class="row">
          <ul>
            {% for ingredient in recipe.ingredients_list %}
            <li>
              <p>{{ ingredient }}</p>
            </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="row">
        <h4>Instructions:</h4>
        <div class="row">{{ recipe.instructions | safe }}</div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col">
      <hr />
    </div>
  </div>
  <div class="row">
    {% if user.is_authenticated %}
    <div class="col-md-8">
      <h4>Comments:</h4>
      <div class="card-body">
        {% for comment in comments %}
        <div class="container">
          <div class="row">
            <p class="font-weight-bold">{{ comment.name }}:</p>
            <p>{{ comment.body | linebreaks }}</p>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    <div class="col-md-4">
      <div class="row">
        {% if user.is_authenticated %}
        <h4>Give this recipe a star rating:</h4>
        <form method="POST" style="margin-top: 1.3em" action="{% url 'recipe_rating' recipe.slug %}">
            {% csrf_token %}
            {% if rate == 0 %}
            
            <button type="submit" name="star" id="star-1" class="star-btn" value="1"><i class="fas fa-star"></i></button>
            <button type="submit" name="star" id="star-2" class="star-btn" value="2"><i class="fas fa-star"></i></button>
            <button type="submit" name="star" id="star-3" class="star-btn" value="3"><i class="fas fa-star"></i></button>
            <button type="submit" name="star" id="star-4" class="star-btn" value="4"><i class="fas fa-star"></i></button>
            <button type="submit" name="star" id="star-5" class="star-btn" value="5"><i class="fas fa-star"></i></button>

            {% else %}
            <p>Banana</p>
            {% endif %}
            <input type="hidden" name="recipe_id" id="recipe_id" value="{{recipe.id}}"/>
        </form>
        {% endif %}
      </div>
      <div class="row">
        {% if commented %}
        <div class="alert alert-success" role="alert">
            Your comment is awaiting approval
        </div>
        {% else %}
        <h4>Leave a comment:</h4>
        <p>Posting as: {{ user.username }}</p>
        <form method="post" style="margin-top: 1.3em">
            {{ comment_form | crispy }} {% csrf_token %}
            <button type="submit" name="comment_form" class="btn btn-lg">Submit</button>
        </form>
        {% endif %}
      </div>
    </div>

    {% else %}
    <div class="col-md-12">
      <h4>Comments:</h4>
      <div class="card-body">
        {% for comment in comments %}
        <div class="container">
          <div class="row">
            <p class="font-weight-bold">{{ comment.name }}:</p>
            <p>{{ comment.body | linebreaks }}</p>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
  </div>
</div>

{% endblock %}
